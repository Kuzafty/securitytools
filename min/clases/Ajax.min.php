<?php class Ajax{public static function ajax_start($requestType,$contentType){if($_SERVER['REQUEST_METHOD']!==strtoupper($requestType)||!self::is_same_origin()){return false;}header('Content-Type: application/'.$contentType);return true;}private static function is_same_origin(){if(!isset($_SERVER['HTTP_REFERER'])){return false;}$referer=parse_url($_SERVER['HTTP_REFERER']);$referer_origin=$referer['scheme'].'://'.$referer['host'];$server_origin=(isset($_SERVER['HTTPS'])&&$_SERVER['HTTPS']==='on'?"https":"http")."://{$_SERVER['HTTP_HOST']}";return($referer_origin===$server_origin);}public static function ajax_error(){http_response_code(400);}public static function ajax_success(){http_response_code(200);}public static function ajax_value($expression){if($expression){self::ajax_success();}else{self::ajax_error();}}public static function ajax_token($token_name,$source='post',$time=null){switch(strtolower($source)){case 'post':$token_value=isset($_POST[$token_name])?$_POST[$token_name]:null;break;case 'get':$token_value=isset($_GET[$token_name])?$_GET[$token_name]:null;break;case 'cookie':$token_value=isset($_COOKIE[$token_name])?$_COOKIE[$token_name]:null;break;case 'request':$token_value=isset($_REQUEST[$token_name])?$_REQUEST[$token_name]:null;break;default:return false;}if($token_value===null){return false;}if($time!==null){return Token::processTime($token_value,$token_name,$time);}else{return Token::process($token_value,$token_name);}}} ?>